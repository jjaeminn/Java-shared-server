<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>편의점 행사상품 모음</title>
    <style>
        /* 공통 스타일 */ 
        body {   
            font-family: '맑은 고딕', sans-serif;   
            margin: 0;   
            padding: 0;   
            background-color: #f0f0f0; 
        }  

        /* 헤더 */ 
        header {   
            background-color: #ffffff;   
            padding: 10px 20px;   
            display: flex;   
            align-items: center;   
            justify-content: space-between;   
            border-bottom: 1px solid #ddd;   
            flex-wrap: wrap; 
        }  

        header h1 {   
            font-size: 20px;   
            font-weight: bold;   
            color: black;   
            margin: 0 30px 0 10px;   
            cursor: pointer;
            text-decoration: none;
        }  

        header h1 a {
            color: black;
            text-decoration: none;
        }

        nav ul {   
            list-style: none;   
            display: flex;   
            flex-wrap: wrap;   
            gap: 20px;   
            margin: 0;   
            padding: 0; 
        }  

        nav ul li a {   
            text-decoration: none;   
            color: gray;   
            font-weight: 500;   
            font-size: 15px; 
        }

        nav ul li a:hover {
            color: #333;
        }

        .search-login {   
            display: flex;   
            align-items: center;   
            gap: 10px; 
        }  

        .search-login input {
            padding: 6px 12px;
            border: 1px solid #ddd;
            border-radius: 3px;
            font-size: 14px;
            width: 200px;
        }

        header button {   
            padding: 6px 12px;   
            background-color: #333;   
            color: white;   
            border: none;   
            border-radius: 3px;   
            cursor: pointer; 
        }

        header button:hover {
            background-color: #555;
        }

        /* 사이드 네비게이션 */ 
        .nav-menu {   
            position: fixed;   
            top: 0;   
            right: -250px;   
            width: 230px;   
            height: 100%;   
            background-color: #fff;   
            box-shadow: -2px 0 5px rgba(0, 0, 0, 0.3);   
            padding: 20px;   
            transition: right 0.3s ease;   
            z-index: 999;   
            visibility: hidden;   
            opacity: 0;   
            pointer-events: none; 
        }  

        .nav-menu.active {   
            right: 0;   
            visibility: visible;   
            opacity: 1;   
            pointer-events: auto; 
        }  

        .nav-menu .close-btn {   
            background: none;   
            border: none;   
            font-size: 22px;   
            cursor: pointer;   
            float: right;   
            margin-bottom: 20px; 
        }  

        .nav-menu ul {   
            list-style: none;   
            padding: 0; 
        }  

        .nav-menu ul li {   
            margin: 15px 0; 
        }  

        .nav-menu ul li a {   
            text-decoration: none;   
            color: #333;   
            font-weight: bold; 
        }  

        /* 메인 레이아웃 */ 
        main {   
            background-color: #f0f0f0;   
            padding: 30px;   
            max-width: 1000px;   
            margin: 0 auto; 
        }  

        footer {   
            text-align: center;   
            padding: 20px;   
            background-color: #ccc; 
        }

        footer a {
            color: #333;
            text-decoration: none;
        }

        /* 브랜드 선택 섹션 */
        .brand-selection {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin: 20px 0;
            flex-wrap: wrap;
        }

        .brand-item {
            padding: 8px 12px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.2s ease;
            font-weight: bold;
            background-color: #ffffff;
            text-decoration: none;
            display: flex;
            align-items: center;
            min-width: 100px;
            justify-content: center;
        }

        .brand-item:hover {
            background-color: #b6b6b6;
            text-decoration: none;
        }

        .brand-item.gs25 {
            color: #97e0e0;
        }

        .brand-item.cu {
            color: #50409f;
        }

        .brand-item.emart24 {
            color: #dbb148;
        }

        .brand-item.seven {
            color: #043d22;
        }

        .brand-item.all {
            color: #000000;
        }

        .brand-item img {
            height: 20px;
            margin-right: 5px;
        }

        .brand-item svg {
            margin-right: 5px;
        }

        /* 필터 카드 */
        .filter-card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }

        .filter-card h5 {
            margin-bottom: 15px;
            color: #333;
            font-size: 18px;
        }

        .filter-row {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            align-items: end;
            justify-content: center;
        }

        .filter-group {
            display: flex;
            flex-direction: column;
            min-width: 120px;
        }

        .filter-group label {
            margin-bottom: 5px;
            font-weight: 500;
            color: #333;
        }

        .filter-group select,
        .filter-group input {
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
        }

        .filter-btn {
            padding: 8px 20px;
            background-color: #333;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            height: fit-content;
        }

        .filter-btn:hover {
            background-color: #555;
        }

        /* 페이지 제목 */
        .page-header {
            margin-bottom: 20px;
        }

        .page-header h1 {
            color: #333;
            font-size: 28px;
            margin-bottom: 10px;
        }

        .page-header h4 {
            color: #666;
            font-size: 18px;
            margin-bottom: 10px;
        }

        .search-count {
            color: #666;
            font-size: 14px;
        }

        /* 상품 카드 */
        .products-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .product-card {
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            position: relative;
            height: 100%;
        }

        .product-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }

        .product-img-container {
            width: 100%;
            height: 200px;
            overflow: hidden;
            position: relative;
            background-color: #f8f9fa;
        }

        .product-img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            object-position: center;
            transition: transform 0.3s ease;
        }

        .product-img:hover {
            transform: scale(1.05);
        }

        .product-info {
            padding: 15px;
        }

        .product-title {
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 8px;
            line-height: 1.3;
            height: 40px;
            overflow: hidden;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
        }

        .product-price {
            color: #e91e63;
            font-weight: bold;
            font-size: 16px;
            margin-bottom: 5px;
        }

        .product-category {
            color: #666;
            font-size: 12px;
        }

        .promotion-badge {
            position: absolute;
            top: 10px;
            left: 10px;
            background: #333;
            color: white;
            padding: 5px 8px;
            border-radius: 15px;
            font-size: 12px;
            z-index: 2;
        }

        .brand-badge {
            position: absolute;
            top: 10px;
            right: 10px;
            background: rgba(255, 255, 255, 0.9);
            padding: 5px 8px;
            border-radius: 15px;
            font-size: 11px;
            display: flex;
            align-items: center;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .brand-badge img {
            height: 16px;
            margin-right: 4px;
        }

        .brand-badge.gs25 {
            background: rgba(151, 224, 224, 0.9);
            color: white;
        }

        .brand-badge.cu {
            background: rgba(80, 64, 159, 0.9);
            color: white;
        }

        .brand-badge.emart24 {
            background: rgba(219, 177, 72, 0.9);
            color: white;
        }

        .brand-badge.seven {
            background: rgba(4, 61, 34, 0.9);
            color: white;
        }

        /* 알림 메시지 */
        .alert {
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 5px;
            background-color: #d1ecf1;
            border: 1px solid #bee5eb;
            color: #0c5460;
        }

        /* 페이지네이션 */
        .pagination-container {
            display: flex;
            justify-content: center;
            margin-top: 30px;
        }

        .pagination {
            display: flex;
            list-style: none;
            padding: 0;
            gap: 5px;
        }

        .page-item {
            display: block;
        }

        .page-link {
            padding: 8px 12px;
            text-decoration: none;
            color: #333;
            border: 1px solid #ddd;
            border-radius: 3px;
            background: white;
        }

        .page-link:hover {
            background-color: #f8f9fa;
        }

        .page-item.active .page-link {
            background-color: #333;
            color: white;
            border-color: #333;
        }

        .page-item.disabled .page-link {
            color: #6c757d;
            background-color: #fff;
            border-color: #dee2e6;
            cursor: not-allowed;
        }

        /* 반응형 */
        @media (max-width: 768px) {
            header {
                flex-direction: column;
                gap: 10px;
            }

            nav ul {
                justify-content: center;
            }

            .brand-selection {
                flex-direction: column;
                align-items: center;
            }

            .filter-row {
                flex-direction: column;
            }

            .filter-group {
                width: 100%;
            }

            main {
                padding: 15px;
            }

            .search-login input {
                width: 150px;
            }
        }
    </style>
</head>
<body>
    <!-- 헤더 -->
    <header>
        <h1>
            <a href="/">
                {% if current_brand %}
                {{ cvs_brands[current_brand]['name'] }} 행사상품
                {% else %}
                편의점 행사상품 모음
                {% endif %}
            </a>
        </h1>
        
        <nav>
            <ul>
                <li><a href="/">전체상품</a></li>
                <li><a href="/map">편의점 지도</a></li>
                <li><a href="/admin">관리자</a></li>
                <li><a href="#" onclick="toggleMenu('promotion')">행사유형</a></li>
                <li><a href="#" onclick="toggleMenu('category')">카테고리</a></li>
                <li><a href="http://localhost:3001">상품등록</a></li>
            </ul>
        </nav>
        
        <div class="search-login">
            <form action="/search" method="get" style="display: flex; gap: 10px;">
                <input type="search" name="keyword" placeholder="상품명 검색" 
                       value="{{ search_keyword or '' }}" aria-label="Search">
                <button type="submit">검색</button>
            </form>
        </div>
    </header>

    <!-- 사이드 네비게이션 -->
    <div class="nav-menu" id="navMenu">
        <button class="close-btn" onclick="closeMenu()">&times;</button>
        <ul id="menuContent">
            <!-- 동적으로 채워질 내용 -->
        </ul>
    </div>

    <!-- 메인 콘텐츠 -->
    <main>
        <!-- 브랜드 선택 섹션 -->
        <div class="brand-selection">
            <a href="/" class="brand-item all">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" viewBox="0 0 16 16">
                    <path d="M2.97 1.35A1 1 0 0 1 3.73 1h8.54a1 1 0 0 1 .76.35l2.609 3.044A1.5 1.5 0 0 1 16 5.37v.255a2.375 2.375 0 0 1-4.25 1.458A2.371 2.371 0 0 1 9.875 8 2.37 2.37 0 0 1 8 7.083 2.37 2.37 0 0 1 6.125 8a2.37 2.37 0 0 1-1.875-.917A2.375 2.375 0 0 1 0 5.625V5.37a1.5 1.5 0 0 1 .361-.976l2.61-3.045z"/>
                </svg>
                전체
            </a>
            
            <a href="/brand/gs25" class="brand-item gs25">
                GS25
            </a>
            
            <a href="/brand/cu" class="brand-item cu">
                CU
            </a>
            
            <a href="/brand/emart24" class="brand-item emart24">
                Emart24
            </a>
            
            <a href="/brand/seven" class="brand-item seven">
                7-Eleven
            </a>
        </div>

        <!-- 필터 카드 -->
        <div class="filter-card">
            <h5>상세 필터</h5>
            <form action="/filter" method="get" class="filter-row">
                <div class="filter-group">
                    <label>편의점</label>
                    <select name="cvs_brand">
                        <option value="">전체</option>
                        <option value="gs25" {% if current_brand == 'gs25' %}selected{% endif %}>GS25</option>
                        <option value="cu" {% if current_brand == 'cu' %}selected{% endif %}>CU</option>
                        <option value="emart24" {% if current_brand == 'emart24' %}selected{% endif %}>이마트24</option>
                        <option value="seven" {% if current_brand == 'seven' %}selected{% endif %}>세븐일레븐</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label>행사유형</label>
                    <select name="promotion_type">
                        <option value="">전체</option>
                        <option value="1+1" {% if current_promotion == '1+1' %}selected{% endif %}>1+1</option>
                        <option value="2+1" {% if current_promotion == '2+1' %}selected{% endif %}>2+1</option>
                        <option value="할인" {% if current_promotion == '할인' %}selected{% endif %}>할인</option>
                        <option value="덤증정" {% if current_promotion == '덤증정' %}selected{% endif %}>덤증정</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label>카테고리</label>
                    <select name="category">
                        <option value="">전체</option>
                        <option value="음료" {% if current_category == '음료' %}selected{% endif %}>음료</option>
                        <option value="과자" {% if current_category == '과자' %}selected{% endif %}>과자</option>
                        <option value="식품" {% if current_category == '식품' %}selected{% endif %}>식품</option>
                        <option value="생활용품" {% if current_category == '생활용품' %}selected{% endif %}>생활용품</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label>정렬기준</label>
                    <select name="sort_by">
                        <option value="id" {% if current_sort == 'id' %}selected{% endif %}>최신순</option>
                        <option value="상품명" {% if current_sort == '상품명' %}selected{% endif %}>상품명</option>
                        <option value="가격" {% if current_sort == '가격' %}selected{% endif %}>가격</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label>정렬방향</label>
                    <select name="sort_order">
                        <option value="DESC" {% if current_order == 'DESC' %}selected{% endif %}>내림차순</option>
                        <option value="ASC" {% if current_order == 'ASC' %}selected{% endif %}>오름차순</option>
                    </select>
                </div>
                <button type="submit" class="filter-btn">적용</button>
            </form>
        </div>

        <!-- 페이지 제목 및 검색 결과 정보 -->
        <div class="page-header">
            <h1>
                {% if current_brand %}
                {{ cvs_brands[current_brand]['name'] }} 행사상품
                {% else %}
                편의점 행사상품 모음
                {% endif %}
            </h1>
            
            {% if current_promotion %}
            <h4>'{{ current_promotion }}' 행사 상품</h4>
            {% elif current_category %}
            <h4>'{{ current_category }}' 카테고리 상품</h4>
            {% elif search_keyword %}
            <h4>'{{ search_keyword }}' 검색 결과</h4>
            {% endif %}
            
            <!-- 검색 결과 수 표시 -->
            {% if products %}
            <p class="search-count">총 {{ products|length }}개의 상품</p>
            {% endif %}
        </div>

        <!-- 상품 목록 -->
        {% if products %}
        <div class="products-grid">
            {% for product in products %}
            <div class="product-card">
                <div class="product-img-container">
                    {% if product.image_url %}
                    <img src="{{ product.image_url }}" class="product-img" alt="{{ product.product_name }}">
                    {% else %}
                    <div style="text-align: center; padding: 80px 0; color: #999;">이미지 없음</div>
                    {% endif %}
                </div>
                <div class="promotion-badge">{{ product.promotion_type }}</div>
                <div class="brand-badge {{ product.cvs_brand }}">
            
                    {{ product.brand_info.name }}
                </div>
                <div class="product-info">
                    <div class="product-title">{{ product.product_name }}</div>
                    <div class="product-price">{{ product.price }}원</div>
                    <div class="product-category">{{ product.event_category }}</div>
                </div>
            </div>
            {% endfor %}
        </div>
        {% else %}
        <div class="alert">
            현재 표시할 상품이 없습니다.
        </div>
        {% endif %}
        
        <!-- 페이지네이션 -->
        <div class="pagination-container">
            <nav aria-label="Page navigation">
                <ul class="pagination">
                    <li class="page-item disabled">
                        <a class="page-link" href="#" tabindex="-1" aria-disabled="true">이전</a>
                    </li>
                    <li class="page-item active"><a class="page-link" href="#">1</a></li>
                    <li class="page-item"><a class="page-link" href="#">2</a></li>
                    <li class="page-item"><a class="page-link" href="#">3</a></li>
                    <li class="page-item">
                        <a class="page-link" href="#">다음</a>
                    </li>
                </ul>
            </nav>
        </div>
    </main>

    <footer>
        <p>&copy; 2025 편의점 행사상품 모음 웹사이트</p>
        <a href="http://localhost:3001">등록페이지로 돌아가기</a>
    </footer>

    <script>
        function toggleMenu(type) {
            const navMenu = document.getElementById('navMenu');
            const menuContent = document.getElementById('menuContent');
            
            let content = '';
            
            if (type === 'promotion') {
                content = `
                    <li><a href="/products/1+1">1+1</a></li>
                    <li><a href="/products/2+1">2+1</a></li>
                    <li><a href="/products/할인">할인</a></li>
                    <li><a href="/products/덤증정">덤증정</a></li>
                `;
            } else if (type === 'category') {
                content = `
                    <li><a href="/category/음료">음료</a></li>
                    <li><a href="/category/과자">과자</a></li>
                    <li><a href="/category/식품">식품</a></li>
                    <li><a href="/category/생활용품">생활용품</a></li>
                `;
            }
            
            menuContent.innerHTML = content;
            navMenu.classList.add('active');
        }

        function closeMenu() {
            const navMenu = document.getElementById('navMenu');
            navMenu.classList.remove('active');
        }

        // 사이드 메뉴 외부 클릭시 닫기
        document.addEventListener('click', function(e) {
            const navMenu = document.getElementById('navMenu');
            if (navMenu.classList.contains('active') && !navMenu.contains(e.target) && !e.target.closest('nav')) {
                closeMenu();
            }
        });

        // 페이지 로드 후 디버깅
        document.addEventListener('DOMContentLoaded', function() {
            console.log('페이지 완전 로드됨');
            
            // 상품 카드 개수 확인
            const productCards = document.querySelectorAll('.product-card');
            console.log(`상품 카드 개수: ${productCards.length}`);
        });
    </script>
</body>
</html>
